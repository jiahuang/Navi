{%extends "layout.html" %}
{% block head%}
<script type="text/javascript">
$(document).ready(function() {
	var rowId = 0;
	
	$('article.tabs section > h3').click(function(){
			$('article.tabs section').removeClass('current');
			$(this).closest('section').addClass('current');
	});
	
	$('#loginFormButton').click(function(){
		$.post('/login', 
			{ email: $('#email-login').val(), password: $('#pw-login').val()},
			function(data){
				console.log(data);
				if ('error' in data){
					// TODO: swap this out for a flashed message
					alert(data.error)
				}
				else
					window.location.reload();
			},
			'json'
		)
		return false;
	});
	
	$('#signupFormButton').click(function(){
		$.post('/new', 
			{ email: $('#email-signup').val(), password: $('#pw-signup').val()},
			function(data){
				console.log(data);
				if ('error' in data)
					alert(data.error)
				else
					window.location.reload();
			},
			'json'
		)
		return false;
	});
	
	$(document).keypress(function(e) {
		if(e.keyCode == 13) {
			// add item to dom
			// grab url
			var url = $('#addUrl').val();
			var d = new Date();
			var id = rowId;
			var tr = $('<tr>')
				.append($('<td>')
					.append($('<div>')
						.attr('class', 'no_notification')
						.text('0')
					)
				).append($('<td>')
					.append($('<div>')
						.attr('class', 'url')
						.text(url)
					)
				).append($('<td>')
					.append($('<div>')
						.attr('class', 'time')
						.text(d.getMonth()+"/"+d.getDate()+" "+d.getHours()+":"+d.getMinutes()+":"+d.getSeconds())
					)
				).append($('<td>')
					.append($('<div>')
						.attr('class', 'expired')
					)
				).attr('id', id);
			rowId++;
			$('#urlTable tr:first').after(tr);
			// add a url 
			$.post('/urls', 
				{'url':url},
				function(data){
					console.log(data);
					// if item could not be correctly processed, flash message and delete added row
					if (data.error != 'false'){
						alert(data.error);
						alert(id);
						$('#'+id).remove();
					}
				} 
			)
		}
	});
});
</script>

{% endblock%}
{% block body %}
	
	{% if session.logged_in %}
		<input type=text id="addUrl" ></input>
		<table id="urlTable" style="width:800px; margin:30px auto; display:block;" border="0" cellspacing="0">
			<tr id="headerRow" style="background-color:#CEE5F5; height:30px;">
				<td width="50px"><div class="notification" style="width:13px; margin-left:auto; margin-right:auto;">#</div></td>
				<td width="600px"><div class="header" style="width:25px; margin-left:auto; margin-right:auto;">Url</div> </td>
				<td width="80px"><div class="header" style="width:55px; margin-left:auto; margin-right:auto;">Added</div> </td>
				<td width="80px"><div class="header" style="width:60px; margin-left:auto; margin-right:auto;">Expired</div></td>
			</tr>
		</table>
		
	{% else %}
		<div id="loginBox">
			 <article class="tabs">
				<section>
					<h3>Log In</h3>
					<div>
						<form id="loginForm">
							<table>
								<tr>
									<td align="right">
										Email 
									</td>
									<td>
										<input type="text" name="email" id="email-login"/>
									</td>
									
								</tr>
								<tr>
									<td align="right">
										Password 
									</td>
									<td>
										<input type="password" name="password" id="pw-login"/> 
									</td>
								</tr>
								<tr>
									<td colspan="2">
										<input type="submit" id="loginFormButton" style="float:right; margin-top:20px;" value="Log In"/>
									</td>
								</tr>
							</table>
						</form>
					</div>
				</section>
				<section class="current">
					<h3>Sign Up</h3>
					<div>
						<form id="signupForm">
							<table>
								<tr>
									<td align="right">
										Email 
									</td>
									<td>
										<input type="text"  name="email" id="email-signup"/>
									</td>
									
								</tr>
								<tr>
									<td align="right">
										Password 
									</td>
									<td>
										<input type="password"  name="password" id="pw-signup"/> 
									</td>
								</tr>
								<tr>
									<td colspan="2">
										<input type="submit" id="signupFormButton" style="float:right; margin-top:20px;" value="Create Account"/>
									</td>
								</tr>
							</table>
						</form>
					</div>
				</section>
			</article>

		</div>
	{% endif %} 
{% endblock %}
